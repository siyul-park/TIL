# 컴퓨터 구조

## 집합 연관 캐쉬

### 캐쉬 성능의 측정 및 향상

- 캐쉬 성능을 향상시키기 위한 두가지 기술
  1. 연관성 이용
  2. 다단계 캐싱
- CPU 시간
  - CPU 시간  = (CPU 클럭 사이클 + 메모리 지연 클럭 사이클) * 클럭 사이클 시간
  - 메모리 지연 사이클은 주로 캐쉬 실패 때문에 생긴다.



### 메모리 지연

- 메모리 지연 클럭 사이클 = 읽기 지연 클럭 사이클 + 쓰기 지연 클럭 사이클
- 읽기 지연 사이클 = (읽기 접근 횟수/프로그램) * 읽기 실패율 * 읽기 실패 손실
- 쓰기 지연 사이클 = (쓰기 접근 횟수/프로그램) * 쓰기 실패율 * 쓰기 실패 손실



### 단순화

- 가정
  - 읽기 실패 손실 = 쓰기 실패 손실
  - 읽기 실패율 = 쓰기 실패율
  - 무시할 수 있는 쓰기 버퍼 지연
- 메모리 지연 클럭 사이클 = (메모리 접근 횟수/프로그램) * 실패/명령어 * 실패 손실 = 명령어/프로그램 * 메모리 접근/명령어 * 실패/메모리 접근 * 실패 손실 = IC * 명령어 접근/명령어 * 실패율 * 실패 손실



### RISC 아키텍쳐에서 해저드

- 메모리 지연 클럭 사이클 = (메모리 접근 횟수/프로그램) * 실패/명령어 * 실패 손실 = 명령어/프로그램 * 메모리 접근/명령어 * 실패/메모리 접근 * 실패 손실 = IC * (명령어 실패 사이클 + 데이터 실패 사이클) * 실패 손실 = IC * (1 * I-캐쉬 실패율 + 메모리 참조 명령어의 빈도*D-캐쉬 실패율) *실패 손실



### 더 유연한 블록 배치를 통한 캐쉬 미스 줄이기

- 3가지 배치 방식
  1. 직접 사상
  2. 집합 연관
  3. 연관 방식
- 직접 사상 캐쉬
  - 상위 수준의 단일 위치에 직접 사상
- 연관 방식
  - 블록은 캐쉬내 어디에나 존재할 수 있다
  - 병렬 검색을 위한 특별한 하드웨어가 필요하다
  - CAM (내용 주소 지정 가능 메모리) = 연관 매모리



### n-way 집합 연관 캐쉬

- 각 블록은 n개의 위치중 하나에 놓여질 수 있다
- 집합 크기 = n (블록)
- 집합의 수 = 캐쉬 크기 / n
- 메모리에 각 블록은 인덱스 필드에 의해 캐시 내의 한 집합으로 사상됨
  - 블락은 한 집합으로 직접 사상됨
- 블록은 집합내 어떤 요소에도 놓여질 수 있음
  - 찾기 위해선 집합내 모든 블럭을 검색해야함
- 연관성 증가
  - 실패율 감소 적중 시간 증가



### 많은 연관성

- 실패율의 감소, 그러나 캐시 크기가 커지면 작아진다



### 캐시에 블록의 위치

- 집합 연관 사상

  - 주소의 세부분

    | Tag                                        | Index                         | Block Offset |
    | ------------------------------------------ | ----------------------------- | ------------ |
    | 성공 또는 실패를 결정하기 위해 병렬로 검색 | 집합을 선택하기 위해 사용된다 |              |

- 연관성이 2배로 증가

  - 집합 당 블록 수를 두 배로 늘림
    - 비교기 수를 두 배로 늘림
  - 집합 수를 반으로 줄이기
    - 인덱스의 크기를 1 비트 줄게함
    - 테그의 크기를 1비트 크게함