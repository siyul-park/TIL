# 컴퓨터 구조

## 메모리 해저드

프로세서와 메모리 성능의 차이는 계속 커지고 있다



### 메모리 벽

- 프로세서 대 DRAM 속도 불일치는 계속 증가
- 전반적인 성능에 있어 메모리 계층 구조 (캐시) 설계가 점점 더 중요해지고 있다



### 메모리 계층 구조

- 공학 문제
  - 최소한의 비용으로 최대한의 효과를 얻자
- 실제
  - 빠른 메모리 -> 비쌈 -> 작음
  - 느린 메모리 -> 쌈 -> 큼
- 목표
  - 매우 작은 메모리만큼 빠르게 접근할 수있는 대용량 메모리의 환상을 만들기
- 다중 구조의 메모리
  - 빠른 메모리 : 프로세서 가까이
  - 더 느리고 저렴한 메모리 : 그 이하
- 지역성 원칙
  - 프로그램은 언제나 소규모 주소 공간에 접근한다



### 지역성 원칙

1. 시간적 지역성
   - 시간속 지역성
   - 최근 접근한 항목에 곧 다시 접근한다
2. 공간적 지역성
   - 공간속 지역성
   - 최근 접근한 항목 근처에 곧 접근할 가능성이 있습니다.



### 메모리 계층 구조의 기본적 구조

|  Speed  | Processor |   Size   |  Cost   | Current technology |
| :-----: | :-------: | :------: | :-----: | :----------------: |
| Fastest |  Memory   | Smallest | Highest |        SRAM        |
|   ...   |  Memory   |   ...    |   ...   |        DRAM        |
| Slowest |  Memory   | Biggest  | Lowest  |   Magnetic disk    |



### 히트 (Hit) 와 미스 (Miss)

- 블락
  - 두 레벨 간의 최소 정보 전송 단위
- 히트
  - 프로세서에 의해 요구 된 데이터가 상위 레벨에 있을 때
- 미스
  - 상위 레벨에서 데이터를 찾지 못했을 때
  - 하위 계층에 접근한다
- 히트 비율
  - 상위 레벨에서 발견된 메모리 접근의 비율
- 미스 비율
  - 1 - 히트 비율



### 메모리 계층 구조의 성능

- 히트 시간
  - 상위 계층 메모리에 접근하는 시간
  - 블록 액세스 시간 + 히트 / 미스를 결정하는 시간
- 미스 패널티
  - 하위 계층 메모리에 접근하는 시간 + 해당 블록을 미스를 경험한 레벨로 전송하는 시간 + 블록을 해당 레벨에 삽입하는 시간 + 블록을 요청자에게 전달하는 시간
- 평균 메모리 액세스 시간 (AMAT)
  - 히트 시간 + 미스 비율 * 미스 패널티
    

### 큰 그림

- 시간적 지역성 및 메모리 계층 구조 
  - 최근에 접근 한 데이터 항목을 프로세서에 더 가깝게 접근
- 공간적 지역성 및 메모리 계층 구조
  - 여러 연속적인 단어로 구성된 블록을 상위 수준으로 이동
- 높은 히트 비율을 가진 메모리 계층
  - 액세스 시간 : 가장 높은 레벨에 가까움
  - 크기 : 가장 낮은 레벨과 동일 
- 다단계 포함 속성 
  - Level(i) ⊂ Level(i+1) 
- 다단계 제외 속성
  - Level(i) ∩ Level(i+1) = ϕ
  -  AMD Opteron 안의 64KB L1 와 1MB L2 

​    

### 메모리 기술

| 메모리 기술 |    메모리 접근 시간    | 2012년에 1GiB당 가격 |
| :---------: | :--------------------: | :------------------: |
|    SRAM     |       0.5~2.5ns        |      $500~$1000      |
|    DRAM     |        50~70ns         |       $10~$20        |
|    Flash    |     5,000~50,000ns     |     $0.75~$1.00      |
|  Magenetic  | 5,000,000~20,000,000ns |     $0.05~$0.10      |

- SRAM (정적 랜덤 접근메모리)
  - 읽기 및 쓰기 액세스 시간은 다를 수 있지만 모든 데이텀에 대한 고정 액세스 시간 
  - 새로 고침 할 필요가 없으므로 액세스 시간이 사이클 시간에 매우 가깝다
  - 비트 당 8 개의 트랜지스터
- DRAM (동적 랜덤 접근메모리)
  - 셀에 유지 된 값은 커패시터에 전하로 저장된다 ... 1 트랜지스터 / 비트             
  - 동적 : 정기적으로 (8ms마다) "새로 고침"해야 한다
    - DAC의 활성 사이클의 1 % ~ 2 %를 소비



### 캐쉬의 기본

- 캐쉬의 정의
  - CPU와 메인 메모리 중간의 계층 레벨
  - 접근의 지역성을 활용하도록 관리되는 모든 저장소

- 첫 번째 논문 ... Wilkes [1965]
  - "슬레이브 추억과 동적 스토리지 할당"
- 첫 번째 구현
  - Scarrott의 Cambridge 대학
  - 1965 년 IFIP 총회에서 설명
- 캐시가있는 최초의 상용 기계
  - IBM 360/85, 1960 년대 후반
- "캐시"라는 용어의 첫 번째 사용
  - Conti, Gibson 및 Pitkowsky
  - 1968 년 IBM Systems Journal의 논문